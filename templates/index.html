<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Táº¡o ThÃ´ng Äiá»‡p TÃ¬nh YÃªu VÅ© Trá»¥</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@300;400;600;700&family=Great+Vibes&family=Dancing+Script:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/style/input.css" />
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GRH4K0FDWE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GRH4K0FDWE');
</script>
</head>
<body>
  <div class="cosmic-bg">
    <div class="stars"></div>
    <div class="heart-glow"></div>
    <div class="floating-hearts">
      <div class="floating-heart" style="left: 10%; animation-delay: 0s;">ğŸ’•</div>
      <div class="floating-heart" style="left: 20%; animation-delay: 2s;">ğŸ’–</div>
      <div class="floating-heart" style="left: 30%; animation-delay: 4s;">ğŸ’</div>
      <div class="floating-heart" style="left: 40%; animation-delay: 6s;">ğŸ’—</div>
      <div class="floating-heart" style="left: 50%; animation-delay: 8s;">ğŸ’•</div>
      <div class="floating-heart" style="left: 60%; animation-delay: 1s;">ğŸ’–</div>
      <div class="floating-heart" style="left: 70%; animation-delay: 3s;">ğŸ’</div>
      <div class="floating-heart" style="left: 80%; animation-delay: 5s;">ğŸ’—</div>
      <div class="floating-heart" style="left: 90%; animation-delay: 7s;">ğŸ’•</div>
    </div>
  </div>

  <div class="container">
    <h1>Táº¡o ThÃ´ng Äiá»‡p TÃ¬nh YÃªu VÅ© Trá»¥</h1>
    <p class="subtitle">NÆ¡i tÃ¬nh yÃªu cháº¡m Ä‘áº¿n cÃ¡c vÃ¬ sao âœ¨</p>
    <p class="love-quote">"á» má»i vÅ© trá»¥, má»i dÃ²ng thá»i gian, anh luÃ´n chá»n em"</p>
    
    <div class="form-group">
      <label for="music">Chá»n báº£n nháº¡c tÃ¬nh yÃªu:</label>
      <select id="music" name="music">
        <option value="/static/style/phepmau.mp3">ğŸ’‘ PhÃ©p mÃ u</option>
        <option value="/static/style/NhoEms.mp3">ğŸŒ™ Nhá»› ems</option>
        <option value="/static/style/TungNgayYeuEm.mp3">ğŸ’˜ Tá»«ng ngÃ y yÃªu em</option>
        <option value="/static/style/TranBoNho.mp3">ğŸ¯ TrÃ n bá»™ nhá»›</option>
        <option value="/static/style/DuChoMaiVeSau.mp3">âœ¨ DÃ¹ cho mai vá» sau</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="mainText">ThÃ´ng Ä‘iá»‡p chÃ­nh:</label>
      <input type="text" id="mainText" name="mainText" placeholder="Anh yÃªu em á»Ÿ má»i vÅ© trá»¥ ğŸ’«" maxlength="100">
    </div>
    
    <div class="form-group">
      <label for="subText">ThÃ´ng Ä‘iá»‡p phá»¥:</label>
      <input type="text" id="subText" name="subText" placeholder="DÃ¹ á»Ÿ vÅ© trá»¥ nÃ o, anh váº«n yÃªu em ğŸ’–" maxlength="200">
    </div>
    
    <div class="form-group">
      <label for="messages">Tin nháº¯n bay xuá»‘ng:</label>
      <textarea id="messages" name="messages" rows="5" placeholder="Ná»¥ cÆ°á»i em tháº¯p sÃ¡ng tháº¿ giá»›i cá»§a anh âœ¨
    Má»—i nhá»‹p tim gá»i tÃªn em ğŸ’•
    Em lÃ  mÃ£i mÃ£i cá»§a anh ğŸ’–
    Trong Ã¡nh máº¯t em, anh tháº¥y mÃ¡i nhÃ  ğŸ 
    ChÃºng ta viáº¿t nÃªn chuyá»‡n tÃ¬nh yÃªu cá»§a riÃªng mÃ¬nh ğŸ“–"></textarea>
    </div>
    
    <button class="generate-btn" onclick="generateQR()">Táº¡o MÃ£ QR TÃ¬nh YÃªu</button>
    
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p style="margin-top: 10px; font-family: 'Great Vibes', cursive; font-size: 1.2em;">Äang káº¿t ná»‘i tÃ¬nh yÃªu vÃ o vÅ© trá»¥...</p>
    </div>
    
    <div id="qr-code" class="qr-container"></div>
  </div>

  <script>
    async function generateQR() {
      const music = document.getElementById('music').value;
      const mainText = encodeURIComponent(document.getElementById('mainText').value || 'Anh yÃªu em á»Ÿ má»i vÅ© trá»¥');
      const subText = encodeURIComponent(document.getElementById('subText').value || 'DÃ¹ á»Ÿ vÅ© trá»¥ nÃ o, anh váº«n yÃªu em');
      const messagesInput = document.getElementById('messages').value.split('\n').filter(m => m.trim()).slice(0, 5);
      const messages = encodeURIComponent(messagesInput.join('|'));

      const url = `${window.location.origin}/heart.html?music=${encodeURIComponent(music)}&mainText=${mainText}&subText=${subText}&messages=${messages}`;

      
      console.log("ğŸ”— URL trong mÃ£ QR:", url);

      document.getElementById('loading').style.display = 'block';
      document.getElementById('qr-code').innerHTML = '';

      try {
  const response = await fetch(`https://tym-love-univers.onrender.com/generate-qr`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ url })
  });

  const text = await response.text(); // láº¥y dáº¡ng text trÆ°á»›c
  console.log("ğŸ“¦ Raw response:", text);

  const data = JSON.parse(text); // tá»± parse Ä‘á»ƒ dá»… debug

  document.getElementById('loading').style.display = 'none';
  document.getElementById('qr-code').innerHTML = `
    <img src="${data.qr}" alt="MÃ£ QR">
    <div class="qr-success">ThÃ´ng Ä‘iá»‡p cá»§a báº¡n Ä‘Ã£ sáºµn sÃ ng! ğŸ’•</div>
  `;
} catch (error) {
  console.error('Lá»—i táº¡o mÃ£ QR:', error);
  document.getElementById('loading').style.display = 'none';
  document.getElementById('qr-code').innerHTML = '<p style="color: #ff6b6b; font-family: \'Great Vibes\', cursive; font-size: 1.2em;">Ráº¥t tiáº¿c! CÃ³ lá»—i xáº£y ra. Vui lÃ²ng thá»­ láº¡i ğŸ’”</p>';
}

    }

    document.addEventListener('DOMContentLoaded', function() {
      const formElements = document.querySelectorAll('input, textarea, select');
      formElements.forEach(element => {
        element.addEventListener('focus', function() {
          this.style.transform = 'translateY(-2px)';
        });
        
        element.addEventListener('blur', function() {
          this.style.transform = 'translateY(0)';
        });
      });
    });
  </script>
</body>
</html>
